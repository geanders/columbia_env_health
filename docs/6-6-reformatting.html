<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta property="og:title" content="6.6 Reformatting | Data Visualization in R" />
<meta property="og:type" content="book" />


<meta property="og:description" content="This is a minimal example of using the bookdown package to write a book. The output format for this example is bookdown::gitbook." />
<meta name="github-repo" content="rstudio/bookdown-demo" />

<meta name="author" content="Brooke Anderson" />

<meta name="date" content="2019-03-28" />


<meta name="description" content="This is a minimal example of using the bookdown package to write a book. The output format for this example is bookdown::gitbook.">

<title>6.6 Reformatting | Data Visualization in R</title>

<link href="libs/tufte-css-2015.12.29/tufte.css" rel="stylesheet" />
<link href="libs/tufte-css-2015.12.29/envisioned.css" rel="stylesheet" />
<script src="libs/htmlwidgets-1.3/htmlwidgets.js"></script>
<script src="libs/jquery-1.12.4/jquery.min.js"></script>
<link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet" />
<script src="libs/datatables-binding-0.5/datatables.js"></script>
<link href="libs/dt-core-1.10.16/css/jquery.dataTables.min.css" rel="stylesheet" />
<link href="libs/dt-core-1.10.16/css/jquery.dataTables.extra.css" rel="stylesheet" />
<script src="libs/dt-core-1.10.16/js/jquery.dataTables.min.js"></script>
<link href="libs/crosstalk-1.0.0/css/crosstalk.css" rel="stylesheet" />
<script src="libs/crosstalk-1.0.0/js/crosstalk.min.js"></script>
<script src="libs/plotly-binding-4.8.0/plotly.js"></script>
<script src="libs/typedarray-0.1/typedarray.min.js"></script>
<link href="libs/plotly-htmlwidgets-css-1.39.2/plotly-htmlwidgets.css" rel="stylesheet" />
<script src="libs/plotly-main-1.39.2/plotly-latest.min.js"></script>
<link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-1.3.1/leaflet.js"></script>
<link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet" />
<script src="libs/Proj4Leaflet-1.0.1/proj4-compressed.js"></script>
<script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script>
<link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-binding-2.0.2/leaflet.js"></script>


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="toc.css" type="text/css" />

</head>

<body>



<div class="row">
<div class="col-sm-12">
<div id="TOC">
<ul>
<li><a href="index.html#prerequisites"><span class="toc-section-number">1</span> Prerequisites</a></li>
<li class="has-sub"><a href="2-plot.html#plot"><span class="toc-section-number">2</span> Plot</a><ul>
<li class="has-sub"><a href="2-1-plot-elements.html#plot-elements"><span class="toc-section-number">2.1</span> Plot elements</a><ul>
<li><a href="2-1-plot-elements.html#example-data"><span class="toc-section-number">2.1.1</span> Example data</a></li>
<li><a href="2-1-plot-elements.html#illustrating-plot-elements"><span class="toc-section-number">2.1.2</span> Illustrating plot elements</a></li>
</ul></li>
<li class="has-sub"><a href="2-2-building-a-plot.html#building-a-plot"><span class="toc-section-number">2.2</span> Building a plot</a><ul>
<li><a href="2-2-building-a-plot.html#reading-data"><span class="toc-section-number">2.2.1</span> Reading data</a></li>
<li><a href="2-2-building-a-plot.html#plotting-by-layers"><span class="toc-section-number">2.2.2</span> Plotting by layers</a></li>
</ul></li>
<li><a href="2-3-saving-plots.html#saving-plots"><span class="toc-section-number">2.3</span> Saving plots</a></li>
<li><a href="2-4-learn-more.html#learn-more"><span class="toc-section-number">2.4</span> Learn more</a></li>
</ul></li>
<li class="has-sub"><a href="3-map.html#map"><span class="toc-section-number">3</span> Map</a><ul>
<li><a href="3-1-geographical-data-in-a-tidy-format.html#geographical-data-in-a-tidy-format"><span class="toc-section-number">3.1</span> Geographical data in a tidy format</a></li>
<li><a href="3-2-basic-mapping.html#basic-mapping"><span class="toc-section-number">3.2</span> Basic mapping</a></li>
<li><a href="3-3-learn-more-1.html#learn-more-1"><span class="toc-section-number">3.3</span> Learn more</a></li>
</ul></li>
<li class="has-sub"><a href="4-interact.html#interact"><span class="toc-section-number">4</span> Interact</a><ul>
<li><a href="4-1-dt-datatables.html#dt-datatables"><span class="toc-section-number">4.1</span> DT: Datatables</a></li>
<li><a href="4-2-plotly.html#plotly"><span class="toc-section-number">4.2</span> Plotly</a></li>
<li><a href="4-3-leaflet.html#leaflet"><span class="toc-section-number">4.3</span> Leaflet</a></li>
<li><a href="4-4-learn-more-2.html#learn-more-2"><span class="toc-section-number">4.4</span> Learn more</a></li>
</ul></li>
<li class="has-sub"><a href="5-report.html#report"><span class="toc-section-number">5</span> Report</a><ul>
<li><a href="5-1-rmarkdown.html#rmarkdown"><span class="toc-section-number">5.1</span> RMarkdown</a></li>
<li><a href="5-2-dashboards.html#dashboards"><span class="toc-section-number">5.2</span> Dashboards</a></li>
<li><a href="5-3-learn-more-3.html#learn-more-3"><span class="toc-section-number">5.3</span> Learn more</a></li>
</ul></li>
<li class="has-sub"><a href="6-tidy.html#tidy"><span class="toc-section-number">6</span> Tidy</a><ul>
<li><a href="6-1-tidy-format.html#tidy-format"><span class="toc-section-number">6.1</span> Tidy format</a></li>
<li><a href="6-2-tidyverse-tools.html#tidyverse-tools"><span class="toc-section-number">6.2</span> Tidyverse tools</a></li>
<li class="has-sub"><a href="6-3-subsetting.html#subsetting"><span class="toc-section-number">6.3</span> Subsetting</a><ul>
<li><a href="6-3-subsetting.html#selecting-columns"><span class="toc-section-number">6.3.1</span> Selecting columns</a></li>
<li><a href="6-3-subsetting.html#slicing-rows"><span class="toc-section-number">6.3.2</span> Slicing rows</a></li>
<li><a href="6-3-subsetting.html#filtering-rows"><span class="toc-section-number">6.3.3</span> Filtering rows</a></li>
</ul></li>
<li><a href="6-4-adding.html#adding"><span class="toc-section-number">6.4</span> Adding</a></li>
<li><a href="6-5-summarizing.html#summarizing"><span class="toc-section-number">6.5</span> Summarizing</a></li>
<li><a href="6-6-reformatting.html#reformatting"><span class="toc-section-number">6.6</span> Reformatting</a></li>
<li><a href="6-7-learn-more-4.html#learn-more-4"><span class="toc-section-number">6.7</span> Learn more</a></li>
</ul></li>
<li><a href="7-final-words.html#final-words"><span class="toc-section-number">7</span> Final Words</a></li>
</ul>
</div>
</div>
</div>
<div class="row">
<div class="col-sm-12">
<div id="reformatting" class="section level2">
<h2><span class="header-section-number">6.6</span> Reformatting</h2>
<p>There are two functions from the <code>tidyr</code> package (another member of the tidyverse) that you can use to change between wide and long data: <code>gather</code> and <code>spread</code>. Here is a description of these two functions:</p>
<ul>
<li><code>gather</code>: Take several columns and gather them into two columns, one with the former column names, and one with the former cell values.</li>
<li><code>spread</code>: Take two columns and spread them into multiple columns. Column names for the new columns will come from one of the two original columns, while cell values will come from the other of the original columns.</li>
</ul>
<p>The following examples are from <code>tidyr</code> help files and show the effects of gathering and spreading a dataset.</p>
<p>Here is some simulated wide data:</p>
<pre class="sourceCode r"><code class="sourceCode r">wide_stocks[<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>, ]</code></pre>
<pre><code>##         time        X          Y          Z
## 1 2009-01-01 1.356955 -1.4220383 -1.9378520
## 2 2009-01-02 1.258732 -2.3284751 -0.4195935
## 3 2009-01-03 1.102894  0.4697818  6.1476633</code></pre>
<p>In the <code>wide_stocks</code> dataset, there are separate columns for three different stocks (<code>X</code>, <code>Y</code>, and <code>Z</code>). Each cell gives the value for a certain stock on a certain day. This data isn’t “tidy”, because the identify of the stock (<code>X</code>, <code>Y</code>, or <code>Z</code>) is a variable, and you’ll probably want to include it as a variable in modeling.</p>
<pre class="sourceCode r"><code class="sourceCode r">wide_stocks[<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>, ]</code></pre>
<pre><code>##         time        X          Y          Z
## 1 2009-01-01 1.356955 -1.4220383 -1.9378520
## 2 2009-01-02 1.258732 -2.3284751 -0.4195935
## 3 2009-01-03 1.102894  0.4697818  6.1476633</code></pre>
<p>If you want to convert the dataframe to have all stock values in a single column, you can use <code>gather</code> to convert wide data to long data:</p>
<pre class="sourceCode r"><code class="sourceCode r">long_stocks &lt;-<span class="st"> </span><span class="kw">gather</span>(wide_stocks, <span class="dt">key =</span> stock,
                      <span class="dt">value =</span> price, <span class="op">-</span>time)
long_stocks[<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>, ]</code></pre>
<pre><code>##         time stock     price
## 1 2009-01-01     X  1.356955
## 2 2009-01-02     X  1.258732
## 3 2009-01-03     X  1.102894
## 4 2009-01-04     X  1.063256
## 5 2009-01-05     X -1.484242</code></pre>
<p>In this “long” dataframe, there is now one column that gives the identify of the stock (<code>stock</code>) and another column that gives the price of that stock that day (<code>price</code>):</p>
<pre class="sourceCode r"><code class="sourceCode r">long_stocks[<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>, ]</code></pre>
<pre><code>##         time stock     price
## 1 2009-01-01     X  1.356955
## 2 2009-01-02     X  1.258732
## 3 2009-01-03     X  1.102894
## 4 2009-01-04     X  1.063256
## 5 2009-01-05     X -1.484242</code></pre>
<p>The format for a <code>gather</code> call is:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co">## Generic code</span>
new_df &lt;-<span class="st"> </span><span class="kw">gather</span>(old_df,
                 <span class="dt">key =</span> [name of column with old column names],
                 <span class="dt">value =</span> [name of column with cell values],
                 <span class="op">-</span><span class="st"> </span>[name of <span class="kw">column</span>(s) you want to 
                    exclude from gather])</code></pre>
<p>Notice how easy it is, now that the data is gathered, to use <code>stock</code> for aesthetics of faceting in a <code>ggplot2</code> call:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(long_stocks, <span class="kw">aes</span>(<span class="dt">x =</span> time, <span class="dt">y =</span> price)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_line</span>() <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">facet_grid</span>(. <span class="op">~</span><span class="st"> </span>stock)</code></pre>
<p><img src="navy_public_health_files/figure-html/unnamed-chunk-42-1.png" width="672"  /></p>
<p>If you have data in a “long” format and would like to spread it out, you can use <code>spread</code> to do that:</p>
<pre class="sourceCode r"><code class="sourceCode r">stocks &lt;-<span class="st"> </span><span class="kw">spread</span>(long_stocks, <span class="dt">key =</span> stock, <span class="dt">value =</span> price)
stocks[<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>, ]</code></pre>
<pre><code>##         time         X          Y          Z
## 1 2009-01-01  1.356955 -1.4220383 -1.9378520
## 2 2009-01-02  1.258732 -2.3284751 -0.4195935
## 3 2009-01-03  1.102894  0.4697818  6.1476633
## 4 2009-01-04  1.063256  2.7205359 -0.7516471
## 5 2009-01-05 -1.484242  2.0730321  0.6993561</code></pre>
<p>Notice that this reverses the action of <code>gather</code>.</p>
<p>“Spread” data is typically not tidy, so you often won’t want to use <code>spread</code> when you are preparing data for analysis. However, <code>spread</code> can be very helpful in creating clean tables for final reports and presentations.</p>
<p>For example, if you wanted to create a table with means and standard deviations for each of the three stocks, you could use <code>spread</code> to rearrange the final summary to create an attractive table.</p>
<pre class="sourceCode r"><code class="sourceCode r"> long_stocks <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">group_by</span>(stock) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarize</span>(<span class="dt">N =</span> <span class="kw">n</span>(), <span class="dt">mean =</span> <span class="kw">mean</span>(price), <span class="dt">sd =</span> <span class="kw">sd</span>(price))</code></pre>
<pre><code>## # A tibble: 3 x 4
##   stock     N  mean    sd
##   &lt;chr&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1 X        10 0.212  1.10
## 2 Y        10 0.465  2.16
## 3 Z        10 2.06   3.90</code></pre>
<p>Three important notes:</p>
<ul>
<li>Everything is gathered into one of two columns – one column with the old column names, and one column with the old cell values</li>
<li>With the <code>key</code> and <code>value</code> arguments, you are just providing column names for the two columns that everything’s gathered into.</li>
<li>If there is a column you don’t want to gather (<code>date</code> in the example), use <code>-</code> to exclude it in the <code>gather</code> call.</li>
</ul>
<p>The following examples are from <code>tidyr</code> help files and show the effects of gathering and spreading a dataset.</p>
</div>
<p style="text-align: center;">
<a href="6-5-summarizing.html"><button class="btn btn-default">Previous</button></a>
<a href="6-7-learn-more-4.html"><button class="btn btn-default">Next</button></a>
</p>
</div>
</div>



</body>
</html>
