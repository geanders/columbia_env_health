<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Chapter 6 Tidy | R for Environmental Health Research</title>
  <meta name="description" content="Online booklet for workshop on R for environmental health research, geared to those who already use R for their research but want to learn more tools.">
  <meta name="generator" content="bookdown  and GitBook 2.6.7">

  <meta property="og:title" content="Chapter 6 Tidy | R for Environmental Health Research" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Online booklet for workshop on R for environmental health research, geared to those who already use R for their research but want to learn more tools." />
  <meta name="github-repo" content="rstudio/bookdown-demo" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 6 Tidy | R for Environmental Health Research" />
  
  <meta name="twitter:description" content="Online booklet for workshop on R for environmental health research, geared to those who already use R for their research but want to learn more tools." />
  

<meta name="author" content="Brooke Anderson">


<meta name="date" content="2019-04-09">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="collect.html">
<link rel="next" href="final-words.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />







<script src="libs/htmlwidgets-1.3/htmlwidgets.js"></script>
<link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet" />
<script src="libs/datatables-binding-0.5/datatables.js"></script>
<link href="libs/dt-core-1.10.16/css/jquery.dataTables.min.css" rel="stylesheet" />
<link href="libs/dt-core-1.10.16/css/jquery.dataTables.extra.css" rel="stylesheet" />
<script src="libs/dt-core-1.10.16/js/jquery.dataTables.min.js"></script>
<link href="libs/crosstalk-1.0.0/css/crosstalk.css" rel="stylesheet" />
<script src="libs/crosstalk-1.0.0/js/crosstalk.min.js"></script>
<script src="libs/plotly-binding-4.8.0/plotly.js"></script>
<script src="libs/typedarray-0.1/typedarray.min.js"></script>
<link href="libs/plotly-htmlwidgets-css-1.39.2/plotly-htmlwidgets.css" rel="stylesheet" />
<script src="libs/plotly-main-1.39.2/plotly-latest.min.js"></script>
<link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-1.3.1/leaflet.js"></script>
<link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet" />
<script src="libs/Proj4Leaflet-1.0.1/proj4-compressed.js"></script>
<script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script>
<link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-binding-2.0.2/leaflet.js"></script>


<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Data Visualization in R</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Prerequisites</a></li>
<li class="chapter" data-level="2" data-path="organize.html"><a href="organize.html"><i class="fa fa-check"></i><b>2</b> Organize</a><ul>
<li class="chapter" data-level="2.1" data-path="organize.html"><a href="organize.html#r-projects"><i class="fa fa-check"></i><b>2.1</b> R Projects</a><ul>
<li class="chapter" data-level="2.1.1" data-path="organize.html"><a href="organize.html#example-data"><i class="fa fa-check"></i><b>2.1.1</b> Example data</a></li>
<li class="chapter" data-level="2.1.2" data-path="organize.html"><a href="organize.html#illustrating-plot-elements"><i class="fa fa-check"></i><b>2.1.2</b> Illustrating plot elements</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="organize.html"><a href="organize.html#directory-organization"><i class="fa fa-check"></i><b>2.2</b> Directory organization</a><ul>
<li class="chapter" data-level="2.2.1" data-path="organize.html"><a href="organize.html#reading-data"><i class="fa fa-check"></i><b>2.2.1</b> Reading data</a></li>
<li class="chapter" data-level="2.2.2" data-path="organize.html"><a href="organize.html#plotting-by-layers"><i class="fa fa-check"></i><b>2.2.2</b> Plotting by layers</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="organize.html"><a href="organize.html#learn-more"><i class="fa fa-check"></i><b>2.3</b> Learn more</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="track.html"><a href="track.html"><i class="fa fa-check"></i><b>3</b> Track</a><ul>
<li class="chapter" data-level="3.1" data-path="track.html"><a href="track.html#git"><i class="fa fa-check"></i><b>3.1</b> git</a></li>
<li class="chapter" data-level="3.2" data-path="track.html"><a href="track.html#github"><i class="fa fa-check"></i><b>3.2</b> GitHub</a></li>
<li class="chapter" data-level="3.3" data-path="track.html"><a href="track.html#terminal"><i class="fa fa-check"></i><b>3.3</b> Terminal</a><ul>
<li class="chapter" data-level="3.3.1" data-path="track.html"><a href="track.html#accessing-a-bash-shell"><i class="fa fa-check"></i><b>3.3.1</b> Accessing a Bash Shell</a></li>
<li class="chapter" data-level="3.3.2" data-path="track.html"><a href="track.html#git2r-package"><i class="fa fa-check"></i><b>3.3.2</b> <code>git2r</code> package</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="track.html"><a href="track.html#learn-more-1"><i class="fa fa-check"></i><b>3.4</b> Learn more</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="package.html"><a href="package.html"><i class="fa fa-check"></i><b>4</b> Package</a><ul>
<li class="chapter" data-level="4.1" data-path="package.html"><a href="package.html#r-packages"><i class="fa fa-check"></i><b>4.1</b> R packages</a></li>
<li class="chapter" data-level="4.2" data-path="package.html"><a href="package.html#publishing"><i class="fa fa-check"></i><b>4.2</b> Publishing</a></li>
<li class="chapter" data-level="4.3" data-path="package.html"><a href="package.html#checking"><i class="fa fa-check"></i><b>4.3</b> Checking</a></li>
<li class="chapter" data-level="4.4" data-path="package.html"><a href="package.html#learn-more-2"><i class="fa fa-check"></i><b>4.4</b> Learn more</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="collect.html"><a href="collect.html"><i class="fa fa-check"></i><b>5</b> Collect</a><ul>
<li class="chapter" data-level="5.1" data-path="collect.html"><a href="collect.html#open-data"><i class="fa fa-check"></i><b>5.1</b> Open data</a></li>
<li class="chapter" data-level="5.2" data-path="collect.html"><a href="collect.html#apis"><i class="fa fa-check"></i><b>5.2</b> APIs</a></li>
<li class="chapter" data-level="5.3" data-path="collect.html"><a href="collect.html#ropensci"><i class="fa fa-check"></i><b>5.3</b> ROpenSci</a></li>
<li class="chapter" data-level="5.4" data-path="collect.html"><a href="collect.html#learn-more-3"><i class="fa fa-check"></i><b>5.4</b> Learn more</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="tidy.html"><a href="tidy.html"><i class="fa fa-check"></i><b>6</b> Tidy</a><ul>
<li class="chapter" data-level="6.1" data-path="tidy.html"><a href="tidy.html#tidyverse-tools"><i class="fa fa-check"></i><b>6.1</b> Tidyverse tools</a></li>
<li class="chapter" data-level="6.2" data-path="tidy.html"><a href="tidy.html#tidying-example"><i class="fa fa-check"></i><b>6.2</b> Tidying example</a></li>
<li class="chapter" data-level="6.3" data-path="tidy.html"><a href="tidy.html#learn-more-4"><i class="fa fa-check"></i><b>6.3</b> Learn more</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="final-words.html"><a href="final-words.html"><i class="fa fa-check"></i><b>7</b> Final Words</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">R for Environmental Health Research</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="tidy" class="section level1">
<h1><span class="header-section-number">Chapter 6</span> Tidy</h1>
<p><span class="newthought">The <strong>ggplot2</strong> framework is a</span> very efficient and powerful
framework for
creating visualizations. This comes in part from the fact that it sticks
to a specific data format for its input. It requires you to start with
data in a what’s called a “tidy” format.</p>
<p>In the previous section, I used an example dataset that was already in this
format, to make it easier for you to get started with plotting. However,
to leverage the power of <strong>ggplot2</strong> for real datasets, you have to know
how to get them into this tidy format. This section will explain introduce
you to how you can clean real datasets to convert them into this format
using tidyverse tools, as well as provide some resources for you to use
to develop your skills in “tidying” data.</p>
<div id="tidyverse-tools" class="section level2">
<h2><span class="header-section-number">6.1</span> Tidyverse tools</h2>
<p><span class="newthought">As an epidemiologist,</span> I meet many people who learned SAS as students
and continue
to use it. A common misperception is that R is good for visualizations, but bad for
cleaning data. While in the past this might have been (somewhat) valid, now it couldn’t
be further from the truth. With a collection of tools available through the
<strong>tidyverse</strong>,<a href="#fn29" class="footnote-ref" id="fnref29"><sup>29</sup></a>
you can write clean and compact code to clean even very large and
messy datasets.</p>
<p>The tidyverse works as well as it does because, for many parts of it, it requires
a common input and output, and those input and output specifications are
identical (the tidy data format).<a href="#fn30" class="footnote-ref" id="fnref30"><sup>30</sup></a>
If you want to get a better idea of this concept, and why it’s so powerful,
think of some of the
classic toys, like Legos (train sets and Lincoln logs also
work here). Each piece takes the same input and produces the same output. Think of
the bottom of a Lego—it “inputs” small, regularly-spaced pegs, which are exactly
what’s at the top (“output”) of each Lego block. This common input and output
means that the blocks can be joined together in an extraordinary number of
different combinations, and that you can imagine and then make very complex
structures with the blocks.</p>
<p>The functions in the tidyverse work this way. For the major data cleaning functions,
they all take the same format of input (a tidy tibble) and they all output that
same format of input. Just like you can build Legos on top of each other in different
orders and patterns to create lots of different structures, this framework of
small tools that work on the same type of input and produce the same type of output
allow you to string together lots of small, simple calls to do some very complex things.</p>
<p>To work with data with tidyverse tools, we’ll use two main ideas.
The first is that we’ll use many small tools that each do one thing well and that
can be combined in lots of configurations to achieve complex tasks. The second is
that we’ll string these small functions togther using a special operator
called the “pipe operator”.</p>
<p>The main functions in the tidyverse (sometimes called “verbs”) all do simple things.
For example, there are functions to <code>select</code> certain columns, <code>slice</code> to specific
rows, <code>filter</code> to a set of rows that match some criterion, <code>mutate</code> existing columns
to create new columns or change existing ones in place, and <code>summarize</code> a dataframe,
possibly one that you <code>group_by</code> certain characteristics of the data (e.g., a summary
of mean height <strong>grouped by</strong> gender).</p>
<p>The second main idea for this data cleaning approach is that we’ll use a
<strong>pipe operator</strong> (<code>%&gt;%</code>). This operator lets you input a tidy dataset as the first
argument of a function. In practice, this allows you to string together a “pipeline” of
data cleaning calls that is very clean and compact.</p>
</div>
<div id="tidying-example" class="section level2">
<h2><span class="header-section-number">6.2</span> Tidying example</h2>
<p>We’ve been using an example dataset with fatal motor vehicle accidents. I downloaded the raw
data from the <a href="https://www.nhtsa.gov/research-data/fatality-analysis-reporting-system-fars">Fatality Analysis Reporting System (FARS)</a>, and the
original download was a large zipped file, with separate files for variables about the
accident, the people involved, etc.</p>
<p>In this short booklet, I won’t be able to teach you all the tools you can use to tidy
a dataset in R, but I can quickly walk you through an example to show you how powerful these
tools can be, and how clean and efficient the final code is. R’s power for data analytics
comes in part from these wonderful tools for working with data, and in a typical data analysis
project, I’ll use these tools extensive to create different summaries and views of the data
as I work. You will definitely want to learn these tools if you’re serious about using R,
so I’ve provided several places to go to master them in the “Learn more” section.</p>
<p>For the rest of the section, we’ll look at cleaning up data from the Federal Accident
Reporting System, the source of the example data we’ve used in other sections.
If you completed the set-up in the “Prerequisites”, you should be able to load this
data using:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(<span class="st">&quot;readr&quot;</span>)
fl_accidents &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&quot;data/accident.csv&quot;</span>)</code></pre>
<p>As a reminder, to print out some information about this data, call the object’s name:</p>
<pre class="sourceCode r"><code class="sourceCode r">fl_accidents</code></pre>
<pre><code>## # A tibble: 34,247 x 52
##    STATE ST_CASE VE_TOTAL VE_FORMS PVH_INVL  PEDS PERNOTMVIT PERMVIT
##    &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt;      &lt;dbl&gt;   &lt;dbl&gt;
##  1     1   10001        1        1        0     0          0       1
##  2     1   10002        1        1        0     0          0       1
##  3     1   10003        3        3        0     0          0       3
##  4     1   10004        1        1        0     0          0       1
##  5     1   10005        1        1        0     0          0       2
##  6     1   10006        2        2        0     0          0       4
##  7     1   10007        2        2        0     0          0       2
##  8     1   10008        1        1        0     0          0       1
##  9     1   10009        1        1        0     0          0       1
## 10     1   10010        1        1        0     1          1       1
## # … with 34,237 more rows, and 44 more variables: PERSONS &lt;dbl&gt;,
## #   COUNTY &lt;dbl&gt;, CITY &lt;dbl&gt;, DAY &lt;dbl&gt;, MONTH &lt;dbl&gt;, YEAR &lt;dbl&gt;,
## #   DAY_WEEK &lt;dbl&gt;, HOUR &lt;dbl&gt;, MINUTE &lt;dbl&gt;, NHS &lt;dbl&gt;, RUR_URB &lt;dbl&gt;,
## #   FUNC_SYS &lt;dbl&gt;, RD_OWNER &lt;dbl&gt;, ROUTE &lt;dbl&gt;, TWAY_ID &lt;chr&gt;,
## #   TWAY_ID2 &lt;chr&gt;, MILEPT &lt;dbl&gt;, LATITUDE &lt;dbl&gt;, LONGITUD &lt;dbl&gt;,
## #   SP_JUR &lt;dbl&gt;, HARM_EV &lt;dbl&gt;, MAN_COLL &lt;dbl&gt;, RELJCT1 &lt;dbl&gt;,
## #   RELJCT2 &lt;dbl&gt;, TYP_INT &lt;dbl&gt;, WRK_ZONE &lt;dbl&gt;, REL_ROAD &lt;dbl&gt;,
## #   LGT_COND &lt;dbl&gt;, WEATHER1 &lt;dbl&gt;, WEATHER2 &lt;dbl&gt;, WEATHER &lt;dbl&gt;,
## #   SCH_BUS &lt;dbl&gt;, RAIL &lt;chr&gt;, NOT_HOUR &lt;dbl&gt;, NOT_MIN &lt;dbl&gt;,
## #   ARR_HOUR &lt;dbl&gt;, ARR_MIN &lt;dbl&gt;, HOSP_HR &lt;dbl&gt;, HOSP_MN &lt;dbl&gt;,
## #   CF1 &lt;dbl&gt;, CF2 &lt;dbl&gt;, CF3 &lt;dbl&gt;, FATALS &lt;dbl&gt;, DRUNK_DR &lt;dbl&gt;</code></pre>
<p>This is a large dataset, with over 50 columns and over 34,000 rows. It records details about all of
the fatal motor vehicle accidents in the US in 2017 (at least, that were reported to this database).
Currently it inclues all states, although we’re planning to limit it to Florida.
In this section, you’ll work through cleaning up this data, as you might if you were starting
from this raw data and needed to create summaries and plots similar to those in other sections of
this booklet.</p>
<p>The following piece of code is all the code you need to transform this dataset into the
<code>fl_accidents</code> dataset we’ve used in earlier examples.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(magrittr)
<span class="kw">library</span>(dplyr)
<span class="kw">library</span>(tidyr)</code></pre>
<pre><code>## 
## Attaching package: &#39;tidyr&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:magrittr&#39;:
## 
##     extract</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(stringr)
<span class="kw">library</span>(lubridate)

fl_accidents <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">rename_all</span>(<span class="dt">.funs =</span> str_to_lower) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">select</span>(state, county, day, month, year, latitude, longitud, fatals) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">filter</span>(state <span class="op">==</span><span class="st"> </span><span class="dv">12</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">county =</span> <span class="kw">str_pad</span>(county, <span class="dt">width =</span> <span class="dv">3</span>, <span class="dt">pad =</span> <span class="st">&quot;0&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">unite</span>(<span class="dt">col =</span> fips, <span class="kw">c</span>(state, county), <span class="dt">sep =</span> <span class="st">&quot;&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">unite</span>(<span class="dt">col =</span> date, <span class="kw">c</span>(month, day, year), <span class="dt">sep =</span> <span class="st">&quot;-&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">date =</span> <span class="kw">mdy</span>(date)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">filter</span>(date <span class="op">&gt;=</span><span class="st"> </span><span class="kw">mdy</span>(<span class="st">&quot;9-7-2017&quot;</span>) <span class="op">&amp;</span><span class="st"> </span>date <span class="op">&lt;=</span><span class="st"> </span><span class="kw">mdy</span>(<span class="st">&quot;9-13-2017&quot;</span>))</code></pre>
<pre><code>## # A tibble: 37 x 5
##    fips  date       latitude longitud fatals
##    &lt;chr&gt; &lt;date&gt;        &lt;dbl&gt;    &lt;dbl&gt;  &lt;dbl&gt;
##  1 12031 2017-09-08     30.2    -81.5      1
##  2 12095 2017-09-07     28.5    -81.4      1
##  3 12097 2017-09-08     28.3    -81.3      1
##  4 12095 2017-09-07     28.6    -81.2      1
##  5 12031 2017-09-08     30.2    -81.8      1
##  6 12033 2017-09-07     30.6    -87.4      2
##  7 12023 2017-09-10     30.1    -82.7      1
##  8 12075 2017-09-08     29.6    -82.9      1
##  9 12045 2017-09-09     30.1    -85.3      2
## 10 12031 2017-09-12     30.4    -81.8      1
## # … with 27 more rows</code></pre>
<p>This function takes the large
original dataset. It first <em>renames</em> all the columns—they were in all capital letters,
which are a pain to type in your code, so we’re using a function from the <code>stringr</code> package
to change them all to lowercase. We’re then <em>selecting</em> just the columns we want to work with
for the plot, using their column names to pick them (<code>state</code>, <code>county</code>, etc.). We’re then
<em>filtering</em> to just the observations in Florida (where the state FIPS code is 12).
Counties have five digit FIPS codes that are useful to use when merging different datasets,
including merging in geographic data, and the dataset at this stage has the state part of the
FIPS code and the county part in different columns. The county part is currently in a numeric
class, which I need to “pad” with 0s at the beginning if it’s currently fewer than three digits.
We’ll <em>mutate</em> the county FIPs code to pad it with 0s, using another function from the
<code>stringr</code> package. We’ll then <em>unite</em> the state and county FIPS columns to create a single
column with the 5-digit FIPS code. Next, we want to convert the date information into
a “Date” class, which will let us work with these values more easily. We’ll <em>unite</em>
all the columns with date information (<code>month</code>, <code>day</code>, <code>year</code>) into a single column, and
then we’ll use a function from the <code>lubridate</code> package to <em>mutate</em> this column to have
a date class. Finally, we’ll <em>filter</em> to just the observations with a date within a week of
Hurricane Irma’s landfall on September 10, 2017.</p>
<p>At this stage, don’t worry if you don’t know which functions you should use to clean up a
new dataset, just try to get a feel for how this tidyverse framework is allowing you to
clean up the dataframe with lots of small, interoperable tools. In the example code,
try highlighting and running different portions of the code and check out the output
at each step along the way. This will help you get a better idea for how this process works.</p>
<p>Becoming familiar with these tools so you can use them yourself takes some time, but is well
work the effort. In the “Learn more” section, I’ve got some tips on where you can go to
develop those skills.</p>
<p>Finally, the code above is cleaning the data, but not overwriting the original <code>fl_accidents</code>
object—instead, it’s printing out the result, but not saving it for you to use later. To
use the cleaned data, you’ll need to overwrite the original R object. You can do that in
two ways. First, you can use the gets arrow to assign the output to the same R object name:</p>
<pre class="sourceCode r"><code class="sourceCode r">fl_accidents &lt;-<span class="st"> </span>fl_accidents <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">rename_all</span>(<span class="dt">.funs =</span> str_to_lower) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">select</span>(state, county, day, month, year, latitude, longitud, fatals) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">filter</span>(state <span class="op">==</span><span class="st"> </span><span class="dv">12</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">county =</span> <span class="kw">str_pad</span>(county, <span class="dt">width =</span> <span class="dv">3</span>, <span class="dt">pad =</span> <span class="st">&quot;0&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">unite</span>(<span class="dt">col =</span> fips, <span class="kw">c</span>(state, county), <span class="dt">sep =</span> <span class="st">&quot;&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">unite</span>(<span class="dt">col =</span> date, <span class="kw">c</span>(month, day, year), <span class="dt">sep =</span> <span class="st">&quot;-&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">date =</span> <span class="kw">mdy</span>(date)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">filter</span>(date <span class="op">&gt;=</span><span class="st"> </span><span class="kw">mdy</span>(<span class="st">&quot;9-7-2017&quot;</span>) <span class="op">&amp;</span><span class="st"> </span>date <span class="op">&lt;=</span><span class="st"> </span><span class="kw">mdy</span>(<span class="st">&quot;9-13-2017&quot;</span>))</code></pre>
<p>If you want to be even more compact, you can use something called the <strong>compound pipe operator</strong>
(<code>%&lt;&gt;%</code>). This inputs an R object and then, when it’s done running all the code, overwrites that
R object with the output. You can think of it as combining the <code>&lt;-</code> and <code>%&gt;%</code> operators. Here’s
how you would use it to save the cleaned version of the data to the <code>fl_accidents</code> object name:</p>
<pre class="sourceCode r"><code class="sourceCode r">fl_accidents <span class="op">%&lt;&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">rename_all</span>(<span class="dt">.funs =</span> str_to_lower) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">select</span>(state, county, day, month, year, latitude, longitud, fatals) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">filter</span>(state <span class="op">==</span><span class="st"> </span><span class="dv">12</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">county =</span> <span class="kw">str_pad</span>(county, <span class="dt">width =</span> <span class="dv">3</span>, <span class="dt">pad =</span> <span class="st">&quot;0&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">unite</span>(<span class="dt">col =</span> fips, <span class="kw">c</span>(state, county), <span class="dt">sep =</span> <span class="st">&quot;&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">unite</span>(<span class="dt">col =</span> date, <span class="kw">c</span>(month, day, year), <span class="dt">sep =</span> <span class="st">&quot;-&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">date =</span> <span class="kw">mdy</span>(date)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">filter</span>(date <span class="op">&gt;=</span><span class="st"> </span><span class="kw">mdy</span>(<span class="st">&quot;9-7-2017&quot;</span>) <span class="op">&amp;</span><span class="st"> </span>date <span class="op">&lt;=</span><span class="st"> </span><span class="kw">mdy</span>(<span class="st">&quot;9-13-2017&quot;</span>))</code></pre>
</div>
<div id="learn-more-4" class="section level2">
<h2><span class="header-section-number">6.3</span> Learn more</h2>
<p>To learn more about working with data using tidyverse tools, one of the best sources is the
book <a href="https://r4ds.had.co.nz/">R for Data Science</a> mentioned in an earlier “Learn more” section.
This book is available
for a very reasonable price in paperback as well as free online through bookdown.org. One
of its coauthors (Hadley Wickham) is the creator of the tidyverse and many of its packages.
It includes a full description of the “tidy data” format, as well as lots of instruction on
using tidyverse tools to work with datasets to convert them to, or work with them once they’re
in, this format.</p>
<p>The tidyverse is a very popular tool now for working with data in R. If you nose around the
internet a bit, you should be able to find a lot of example blog posts using tidyverse tools.
Try a Google search to find some examples in a topic area that interests you (e.g., your
favorite sport, a research topic).</p>
<p>RStudio has several cheatsheets (see “Learn more” in the “Plot” section) related to creating
and working with tidy data. These include cheatsheets for working with dates (with the
<code>lubridate</code> package), factors (the <code>forcats</code> package), and strings (the <code>stringr</code> package). You
can find them all <a href="https://www.rstudio.com/resources/cheatsheets/">here</a>. As with plotting, you
will learn a lot very quickly by working through the examples on those cheatsheets, and then
keeping them handy as you try to apply R to explore your own data.</p>

</div>
</div>
<div class="footnotes">
<hr />
<ol start="29">
<li id="fn29"><p><strong>tidyverse.</strong> A collection of packages to work with data in a
“tidy” format, or to convert it to that format if needed. Many of these packages
are developed and maintained by people at RStudio. If you run <code>library("tidyverse")</code>,
you can load the core tidyverse packages in your R session. This way, you avoid
having to load them one by one.<a href="tidy.html#fnref29" class="footnote-back">↩</a></p></li>
<li id="fn30"><p>There are some clear specifications for this
format. I’m not going to go into them here, but several of the references given
in the “Learn More” section go into depth in describing and defining this format.<a href="tidy.html#fnref30" class="footnote-back">↩</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="collect.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="final-words.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/rstudio/bookdown-demo/edit/master/05-tidy.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"download": ["columbia_env_health.pdf"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
