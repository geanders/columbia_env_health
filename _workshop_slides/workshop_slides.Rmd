---
author: Brooke Anderson
address: Colorado State University
title: R PROGRAMMING
subtitle: for environmental health research
date: \today
header-includes:
   - \usepackage{epigraph}
   - \setlength{\epigraphwidth}{0.4\textwidth}
   - \def\inserttotalframenumber{100}
output: binb::presento
---

```{r echo = FALSE, message = FALSE, warning = FALSE}
knitr::opts_knit$set(root.dir = "..")
library(dplyr)
library(ggplot2)
```

## Today's plan

\montserratfont
- \largetext{ORGANIZE} \bigskip
- \largetext{TRACK} \bigskip
- \largetext{PACKAGE} \bigskip
- \largetext{COLLECT} 

## Homework?!

\begin{center}
\url{https://bit.ly/2WQV6XT}
\end{center}

____

\begin{center}
 \hugetext{PREREQUISITES} 
 \medskip 
 \small Setting up 
\end{center}

## Install RStudio Desktop

\centering

\large https://www.rstudio.com/

## Install git

\centering

\large https://git-scm.com/downloads

## Create GitHub account

\centering

\large https://github.com/

## Download example project

\centering

\large https://github.com/geanders/columbia_env_health_examples

____

\begin{center}
 \hugetext{ORGANIZE} 
 \medskip 
 \small Using **R projects** to organize research files
\end{center}

____

\begin{center}
 \largetext{One file : One version} \\
 \medskip 
 \small \textbf{Rule \#1} of research project file organization 
\end{center}

## Organizing research project files

```{r echo = FALSE, out.width = "0.5\\textwidth", fig.align = "center"}
knitr::include_graphics("images/FileSystemCartoon.jpg")
```
\vspace{-0.5cm}
\footnotesize Source: PhDComics

____

\begin{center}
 \largetext{One project : One directory} \\
 \medskip 
 \small \textbf{Rule \#2} of research project file organization 
\end{center}

## Example project directory

```{r echo = FALSE, out.width = "0.6\\textwidth", fig.align = "center"}
knitr::include_graphics("images/directory_organization.jpeg")
```
\vspace{-0.5cm}
\footnotesize Source: "A Guide to Reproducible Code in Ecology and Evolution".
British Ecological Society.

____

\begin{center}
 \largetext{Use consistent names} \\
 \medskip 
 \small \textbf{Rule \#3} of research project file organization
\end{center}

____

## Common project subdirectories

- **data-raw** Raw data and R scripts to clean the raw data. \medskip
- **data** Cleaned data, often saved as `.RData` after being generated by a script in `data-raw`. \medskip
- **R** Code for any functions used in analysis. \medskip
- **figures** Figures created from R code. \medskip
- **reports** R Markdown files and products rendered from those files (e.g., paper drafts, presentations).

____

\begin{center}
 \largetext{Use relative filenames} \\
 \medskip 
 \small \textbf{Rule \#4} of research project file organization
\end{center}

\centering

```
data/my_data_file.csv
figures/figure_1.png
```

## Create R project

\begin{columns}
\begin{column}{0.3\textwidth}
\includegraphics[height = 0.7\textheight]{images/create_r_project}
\end{column}
\begin{column}{0.6\textwidth}
\includegraphics[width = \textwidth]{images/selecting_r_project}
\end{column}
\end{columns}

## Navigating R Projects

```{r echo = FALSE, out.width = "0.4\\textwidth", fig.align = "center"}
knitr::include_graphics("images/navigating_projects.png")
```

## Navigating R Projects

```{r echo = FALSE, out.width = "0.99\\textwidth", fig.align = "center"}
knitr::include_graphics("images/example_repo.png")
```

____

\tikz[overlay,remember picture] \node[opacity=0.2, at=(current page.center)]{%
  \includegraphics[width=1\paperwidth]{images/hidden_files}};
\color{colorblue}
\begin{center}
\hugetext{\montserratfont .Rproj/}
\end{center}



____

\tikz[overlay,remember picture] \node[opacity=0.2, at=(current page.center)]{%
  \includegraphics[width=1\paperwidth]{images/example_code}};
\color{colorblue}
\begin{center}
\hugetext{\montserratfont [Live coding example]}
\end{center}


## Resources

```{r echo = FALSE, out.height = "0.8\\textheight", fig.align = "center"}
knitr::include_graphics("images/repro_research_book.jpeg")
```

____

\begin{center}
 \hugetext{TRACK} 
 \medskip 
 \small \textbf{git and GitHub} for version control
\end{center}

____

```{r echo = FALSE, out.width = "0.8\\textwidth", fig.align = "center"}
knitr::include_graphics("images/GitHubDiagram.png")
```
Source: GitHub

____

\tikz[overlay,remember picture] \node[opacity=0.2, at=(current page.center)]{%
  \includegraphics[width=1\paperwidth]{images/hidden_files}};
\color{colorblue}
\begin{center}
\hugetext{\montserratfont .git/}
\end{center}

## Git commits in RStudio

\small
Once you initialize the project as a git repository, you should have a "Git" window in one of your RStudio panes (top right pane by default). 

```{r echo = FALSE, out.width="0.8\\textwidth", fig.align="center"}
knitr::include_graphics("images/ExampleGitWindow.png")
```

## Git commits in RStudio

\small
When you click on"Commit", it opens a separate commit window : 

```{r echo = FALSE, out.width="0.8\\textwidth", fig.align="center"}
knitr::include_graphics("images/ExampleCommitWindow.png")
```

## Commit messages

```{r echo = FALSE, out.width = "\\textwidth", fig.align = "center"}
knitr::include_graphics("images/git_commit.png")
```
\footnotesize
Source: xkcd

## Browsing history 

\small
On the top left of the Commit window, you can toggle to "History":

```{r echo = FALSE, out.width="0.8\\textwidth", fig.align="center"}
knitr::include_graphics("images/ExampleHistoryWindow.png")
```



____

\tikz[overlay,remember picture] \node[opacity=0.2, at=(current page.center)]{%
  \includegraphics[width=1\paperwidth]{images/example_code}};
\color{colorblue}
\begin{center}
\hugetext{\montserratfont [Live coding example]}
\end{center}

## Using GitHub to collaborate

```{r echo = FALSE, out.width = "0.9\\textwidth", fig.align = "center"}
knitr::include_graphics("images/maze-minecraft.png")
```

\center
\url{https://github.com/ropenscilabs/miner}

## Hosting content with GitHub Pages

```{r echo = FALSE, out.width = "\\textwidth", fig.align = "center"}
knitr::include_graphics("images/github_pages.png")
```


____

\begin{center}
 \hugetext{PACKAGE} 
 \medskip 
 \small Collect R functions in \textbf{packages} 
\end{center}

## Why write R packages

\begin{block}{Software development in biostatistics}
\includegraphics[width = \textwidth]{images/JeffLeekQuote.png}
\\ Source: Jeff Leek, Simply Statistics
\end{block}

## Why write R packages

\footnotesize

Research impacts of NMMAPS package (*Source: Barnett, Huang, and Turner, "Benefits of Publicly Available Data", Epidemiology 2012*):

- As of November 2011, 67 publications had been published using this
data, with 1,781 citations to these papers \medskip
- Research using NMMAPS has been used by the US EPA in creating
  regulatory impact statements for air pollution (particulates and
  ozone) \medskip
- "Thanks to NMMAPS, there is probably no other country in the
  world with a greater understanding of the health effects of air
  pollution and heat waves in its population."

## What an R package looks like

```{r echo = FALSE, fig.align = "center", out.width = "\\textwidth"}
knitr::include_graphics("images/weathermetrics_package.png")
```

## R package template

```{r echo = FALSE, fig.align = "center", out.width = "\\textwidth"}
knitr::include_graphics("images/package_template.png")
```

## Required files

- **R/** or **data/** If you don't have one of these, your package won't do anything \bigskip
- **DESCRIPTION** Needed, but you can't keep the template version as-is \bigskip
- **NAMESPACE** Needed, but you can't keep the template version as-is 

____

\tikz[overlay,remember picture] \node[opacity=0.2, at=(current page.center)]{%
  \includegraphics[width=1\paperwidth]{images/example_code}};
\color{colorblue}
\begin{center}
\hugetext{\montserratfont [Live coding example]}
\end{center}


## Resources

```{r echo = FALSE, out.height = "0.7\\textheight", fig.align = "center"}
knitr::include_graphics("images/p_packages_cover.png.png")
```

\centering
http://r-pkgs.had.co.nz/

## Resources

```{r echo = FALSE, out.width = "0.8\\textwidth", fig.align = "center"}
knitr::include_graphics("images/package-development.pdf")
```
\vspace{-0.5cm}
\small
https://www.rstudio.com/resources/cheatsheets/

## Resources

```{r echo = FALSE, out.width = "0.5\\textwidth", fig.align = "center"}
knitr::include_graphics("images/train_dragon.jpeg")
```

____

\begin{center}
 \hugetext{COLLECT} 
 \medskip 
 \small Leverage \textbf{open data} tools for collecting data
\end{center}

## Data packages

\footnotesize

```{r}
library(hurricaneexposure)
county_wind(counties = "36061", 
            start_year = 1988, end_year = 2015, 
            wind_limit = 17.5) %>% 
  select(storm_id, vmax_sust, storm_dist, closest_date)
```

## Data packages

\footnotesize

```{r}
county_events(counties = "36061", 
              start_year = 1988, end_year = 2015, 
              event_type = "flood") %>% 
  select(storm_id, storm_dist, closest_date)
```

## Data packages

\footnotesize

```{r fig.width = "6in", out.width = "0.9\\textwidth"}
map_counties(storm = "Ivan-2004", metric = "rainfall")
```


## Open Data APIs

```{r eval = FALSE}
library(tigris)
fl_counties <- counties(state = "FL",
                        class = "sf")
```
```{r echo = FALSE}
load("data/fl_counties.RData")
```

```{r echo = FALSE, out.height = "0.5\\textheight", fig.align = "center", fig.width = 4}
ggplot() + 
  geom_sf(data = fl_counties, 
          aes(fill = ALAND)) + 
  theme_bw() + 
  scale_fill_viridis_c(name = "Land area", label = scales::scientific) + 
  theme(axis.text = element_blank(),
        axis.ticks = element_blank())
```

____

\tikz[overlay,remember picture] \node[opacity=0.2, at=(current page.center)]{%
  \includegraphics[width=1\paperwidth]{images/example_code}};
\color{colorblue}
\begin{center}
\hugetext{\montserratfont [Live coding example]}
\end{center}

## Resources

\centering
\Huge #rstats \bigskip

\includegraphics[width = \textwidth]{images/CRAN_package_10000}


## Resources

\centering
\Huge ROpenSci

## Homework!!

\begin{center}
\url{https://bit.ly/2WQV6XT}
\end{center}

